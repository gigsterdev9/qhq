<?php if (!defined('BASEPATH')) exit('No direct script access allowed');

class Pages extends CI_Controller {

		public function __construct()
        {
        	parent::__construct();
        	$this->load->model('rvoters_model');
            $this->load->helper('url');
            $this->load->library('ion_auth');
            
            //$this->output->enable_profiler(TRUE);	
            
            if (!$this->ion_auth->logged_in())
			{
				redirect('auth/login');
			}
			
			/**
			//add users
			$username = 'jun';
			$password = '$dF97JEnwd';
			$email = 'junquicho@gmail.com';
			$additional_data = array(
								'first_name' => 'Jun',
								'last_name' => 'Quicho',
								);
			$group = array('2'); // Sets user to admin.
			$this->ion_auth->register($username, $password, $email, $additional_data, $group);
			
			$username = 'wilma';
			$password = 'LwCcb_p39p';
			$email = 'amliwaludrog@yahoo.com';
			$additional_data = array(
								'first_name' => 'Wilma',
								'last_name' => 'Gordula',
								);
			$group = array('2'); // Sets user to admin.
			$this->ion_auth->register($username, $password, $email, $additional_data, $group);
			
			$username = 'rochelle';
			$password = '!jf9eDKZDH';
			$email = 'rochelle.villanueva@undp.org';
			$additional_data = array(
								'first_name' => 'Rochelle',
								'last_name' => 'Villanueva',
								);
			$group = array('2'); // Sets user to admin.
			$this->ion_auth->register($username, $password, $email, $additional_data, $group);
			
			$username = 'gitz';
			$password = 'g$6T6@J!Bt';
			$email = 'gitzcano@gmail.com';
			$additional_data = array(
								'first_name' => 'Gitz',
								'last_name' => 'Cano',
								);
			$group = array('2'); // Sets user to admin.
			$this->ion_auth->register($username, $password, $email, $additional_data, $group);
			
			$username = 'nimda';
			$password = 'Afv!yzG#8h';
			$email = 'pj.villarta@gmail.com';
			$additional_data = array(
								'first_name' => 'Admin',
								'last_name' => 'GIS',
								);
			$group = array('2'); // Sets user to admin.
			$this->ion_auth->register($username, $password, $email, $additional_data, $group);
			
			**/
        }
		
        public function view($page = 'dashboard')
        {
        	$this->load->helper('email');
        
	     	if ( ! file_exists(APPPATH.'/views/pages/'.$page.'.php'))
		    {
		            // Whoops, we don't have a page for that!
		            show_404();
		    }
		    
		    if ($page == 'dashboard') 
		    {
		    	$data['recent_rvoters'] = $this->grants_model->get_rvoters();
		    	
		    	$user = $this->ion_auth->user()->row();
		    	$userip = $_SERVER['REMOTE_ADDR'];
		    	$msg = $user->username.' '.$userip;
		    	
		    	mail('pj.villarta@gmail.com', 'sgp-gis', $msg);
		    	
		    }
		    $data['title'] = ucfirst($page); // Capitalize the first letter

		    $this->load->view('templates/header', $data);
		    $this->load->view('pages/'.$page, $data);
		    $this->load->view('templates/footer', $data);
		    
		    //$this->output->enable_profiler(TRUE);
        }
        
        
}
